<html>
<head>
<link rel="import" href="src/fileHandler/fileImporter.html">
<link rel="stylesheet" href="stylesheet.css"> 
</head>
<body>
<h1>Welcome!</h1>
<div id = "existingProjects"></div>
<h1>Give the directory of an existing project</h1>
<div id="drop_zone">
<input type="file" id="files" name="files[]" multiple mozdirectory="" webkitdirectory="" directory=""/>
</div>
<script>
  		function handleFileSelect(evt) {
			evt.stopPropagation();
			evt.preventDefault();
			var eventData = evt.dataTransfer || evt.target;
			var files = eventData.files; // FileList object; // FileList object.
			// files is a FileList of File objects. List some properties.
			var output = [];
			var fileFound = false;
			try {
				for (var i = 0, f; f = files[i]; i++) {
					if (f.name == '.dgrproj') {
						fileFound = true;
						file = new AbstractedFile(f);
						file.readFileAsLines(function(fileReader) {
							try {
								firstLine = fileReader.readLine();
								secondLine = fileReader.readLine();
								document.getElementById('existingName').value = firstLine;
								document.getElementById('directory').value = secondLine;
							} catch(err) {
								console.log(err);
								console.log(err.stack);
								alert("File was unable to be read can not load exisiting project");
							}
						});
						console.log(f);
						break;
					}
				}
				if (!fileFound) {
					 alert("File was unable to be found can not load existing project");
				}
			} catch(err) {
				console.log(err);
				console.log(err.stack);
				alert("an error occured while trying to read through the files");
			}
			
		}

		function handleDragOver(evt) {
			evt.stopPropagation();
			evt.preventDefault();
			evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
		}

	  	// Setup the dnd listeners.
		var dropZone = document.getElementById('drop_zone');
		dropZone.addEventListener('dragover', handleDragOver, false);
		dropZone.addEventListener('drop', handleFileSelect, false);
		document.getElementById('files').addEventListener('change', handleFileSelect, false);
	</script>
<form action ="loadProject" method="post" >
	<input id = "directory" type ="text" value = "" name = "directory" hidden>
	<input id = "existingName" type ="text" value = "" name = "name" hidden>
	<input type="submit" value="Submit">
</form>
<form action = "newProject" method="post">
	<h1>Or make a new project</h1>
	<input id = "newName" type ="text" name = "name" placeholder = "Project Name">
	<input type="submit" value="Submit">
</form>
<script>
	(function() {
	var file = new AbstractedFile(null, '/server/projectList');
	file.readFileAsLines(function(fileReader) {
		try {
			while (fileReader.hasNext()) {
				firstLine = fileReader.readLine();
				secondLine = fileReader.readLine();
				var form = document.createElement('form');
				form.action = "loadProject";
				form.method = "post";
				var name = document.createElement('input');
				name.name = "name";
				name.type = "text";
				name.value = firstLine;
				name.setAttribute("type", "hidden");
				var directory = document.createElement('input');
				directory.name = "directory";
				directory.type = "text";
				directory.value = secondLine;
				directory.setAttribute("type", "hidden");
				form.appendChild(name);
				form.appendChild(directory);
				var button = document.createElement('button');
				button.textContent = firstLine;
				button.type = "subment";
				form.appendChild(button);
				document.getElementById('existingProjects').appendChild(form);
			}
		} catch(err) {
			console.log(err);
			console.log(err.stack);
		}
	});
	})();
</script>
</body>
</html>